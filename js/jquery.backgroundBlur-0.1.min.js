function stackBlurImage(a,b,c,d){var e=document.getElementById(a),f=e.naturalWidth,g=e.naturalHeight,h=document.getElementById(b);h.style.width=f+"px";h.style.height=g+"px";h.width=f;h.height=g;var i=h.getContext("2d");i.clearRect(0,0,f,g);i.drawImage(e,0,0);if(isNaN(c)||c<1)return;d?stackBlurCanvasRGBA(b,0,0,f,g,c):stackBlurCanvasRGB(b,0,0,f,g,c)}function stackBlurCanvasRGBA(a,b,c,d,e,f){if(isNaN(f)||f<1)return;f|=0;var g=document.getElementById(a),h=g.getContext("2d"),i;try{try{i=h.getImageData(b,c,d,e)}catch(j){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");i=h.getImageData(b,c,d,e)}catch(j){alert("Cannot access local image");throw new Error("unable to access local image data: "+j)}}}catch(j){alert("Cannot access image");throw new Error("unable to access image data: "+j)}var k=i.data,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=f+f+1,K=d<<2,L=d-1,M=e-1,N=f+1,O=N*(N+1)/2,P=new BlurStack,Q=P;for(n=1;n<J;n++){Q=Q.next=new BlurStack;if(n==N)var R=Q}Q.next=P;var S=null,T=null;r=q=0;var U=mul_table[f],V=shg_table[f];for(m=0;m<e;m++){A=B=C=D=s=t=u=v=0;w=N*(E=k[q]);x=N*(F=k[q+1]);y=N*(G=k[q+2]);z=N*(H=k[q+3]);s+=O*E;t+=O*F;u+=O*G;v+=O*H;Q=P;for(n=0;n<N;n++){Q.r=E;Q.g=F;Q.b=G;Q.a=H;Q=Q.next}for(n=1;n<N;n++){o=q+((L<n?L:n)<<2);s+=(Q.r=E=k[o])*(I=N-n);t+=(Q.g=F=k[o+1])*I;u+=(Q.b=G=k[o+2])*I;v+=(Q.a=H=k[o+3])*I;A+=E;B+=F;C+=G;D+=H;Q=Q.next}S=P;T=R;for(l=0;l<d;l++){k[q+3]=H=v*U>>V;if(H!=0){H=255/H;k[q]=(s*U>>V)*H;k[q+1]=(t*U>>V)*H;k[q+2]=(u*U>>V)*H}else k[q]=k[q+1]=k[q+2]=0;s-=w;t-=x;u-=y;v-=z;w-=S.r;x-=S.g;y-=S.b;z-=S.a;o=r+((o=l+f+1)<L?o:L)<<2;A+=S.r=k[o];B+=S.g=k[o+1];C+=S.b=k[o+2];D+=S.a=k[o+3];s+=A;t+=B;u+=C;v+=D;S=S.next;w+=E=T.r;x+=F=T.g;y+=G=T.b;z+=H=T.a;A-=E;B-=F;C-=G;D-=H;T=T.next;q+=4}r+=d}for(l=0;l<d;l++){B=C=D=A=t=u=v=s=0;q=l<<2;w=N*(E=k[q]);x=N*(F=k[q+1]);y=N*(G=k[q+2]);z=N*(H=k[q+3]);s+=O*E;t+=O*F;u+=O*G;v+=O*H;Q=P;for(n=0;n<N;n++){Q.r=E;Q.g=F;Q.b=G;Q.a=H;Q=Q.next}p=d;for(n=1;n<=f;n++){q=p+l<<2;s+=(Q.r=E=k[q])*(I=N-n);t+=(Q.g=F=k[q+1])*I;u+=(Q.b=G=k[q+2])*I;v+=(Q.a=H=k[q+3])*I;A+=E;B+=F;C+=G;D+=H;Q=Q.next;n<M&&(p+=d)}q=l;S=P;T=R;for(m=0;m<e;m++){o=q<<2;k[o+3]=H=v*U>>V;if(H>0){H=255/H;k[o]=(s*U>>V)*H;k[o+1]=(t*U>>V)*H;k[o+2]=(u*U>>V)*H}else k[o]=k[o+1]=k[o+2]=0;s-=w;t-=x;u-=y;v-=z;w-=S.r;x-=S.g;y-=S.b;z-=S.a;o=l+((o=m+N)<M?o:M)*d<<2;s+=A+=S.r=k[o];t+=B+=S.g=k[o+1];u+=C+=S.b=k[o+2];v+=D+=S.a=k[o+3];S=S.next;w+=E=T.r;x+=F=T.g;y+=G=T.b;z+=H=T.a;A-=E;B-=F;C-=G;D-=H;T=T.next;q+=d}}h.putImageData(i,b,c)}function stackBlurCanvasRGB(a,b,c,d,e,f){if(isNaN(f)||f<1)return;f|=0;var g=document.getElementById(a),h=g.getContext("2d"),i;try{try{i=h.getImageData(b,c,d,e)}catch(j){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");i=h.getImageData(b,c,d,e)}catch(j){alert("Cannot access local image");throw new Error("unable to access local image data: "+j)}}}catch(j){alert("Cannot access image");throw new Error("unable to access image data: "+j)}var k=i.data,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=f+f+1,G=d<<2,H=d-1,I=e-1,J=f+1,K=J*(J+1)/2,L=new BlurStack,M=L;for(n=1;n<F;n++){M=M.next=new BlurStack;if(n==J)var N=M}M.next=L;var O=null,P=null;r=q=0;var Q=mul_table[f],R=shg_table[f];for(m=0;m<e;m++){y=z=A=s=t=u=0;v=J*(B=k[q]);w=J*(C=k[q+1]);x=J*(D=k[q+2]);s+=K*B;t+=K*C;u+=K*D;M=L;for(n=0;n<J;n++){M.r=B;M.g=C;M.b=D;M=M.next}for(n=1;n<J;n++){o=q+((H<n?H:n)<<2);s+=(M.r=B=k[o])*(E=J-n);t+=(M.g=C=k[o+1])*E;u+=(M.b=D=k[o+2])*E;y+=B;z+=C;A+=D;M=M.next}O=L;P=N;for(l=0;l<d;l++){k[q]=s*Q>>R;k[q+1]=t*Q>>R;k[q+2]=u*Q>>R;s-=v;t-=w;u-=x;v-=O.r;w-=O.g;x-=O.b;o=r+((o=l+f+1)<H?o:H)<<2;y+=O.r=k[o];z+=O.g=k[o+1];A+=O.b=k[o+2];s+=y;t+=z;u+=A;O=O.next;v+=B=P.r;w+=C=P.g;x+=D=P.b;y-=B;z-=C;A-=D;P=P.next;q+=4}r+=d}for(l=0;l<d;l++){z=A=y=t=u=s=0;q=l<<2;v=J*(B=k[q]);w=J*(C=k[q+1]);x=J*(D=k[q+2]);s+=K*B;t+=K*C;u+=K*D;M=L;for(n=0;n<J;n++){M.r=B;M.g=C;M.b=D;M=M.next}p=d;for(n=1;n<=f;n++){q=p+l<<2;s+=(M.r=B=k[q])*(E=J-n);t+=(M.g=C=k[q+1])*E;u+=(M.b=D=k[q+2])*E;y+=B;z+=C;A+=D;M=M.next;n<I&&(p+=d)}q=l;O=L;P=N;for(m=0;m<e;m++){o=q<<2;k[o]=s*Q>>R;k[o+1]=t*Q>>R;k[o+2]=u*Q>>R;s-=v;t-=w;u-=x;v-=O.r;w-=O.g;x-=O.b;o=l+((o=m+J)<I?o:I)*d<<2;s+=y+=O.r=k[o];t+=z+=O.g=k[o+1];u+=A+=O.b=k[o+2];O=O.next;v+=B=P.r;w+=C=P.g;x+=D=P.b;y-=B;z-=C;A-=D;P=P.next;q+=d}}h.putImageData(i,b,c)}function BlurStack(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}(function(a){a.fn.backgroundBlur=function(b){var c={imagePath:null,imageType:"png",blurRadius:5},d=a.extend({},c,b),e=a(this),f=a("<canvas/>",{id:"canvas",width:"0",height:"0"}).appendTo("body").get(0).getContext("2d"),g=new Image;e.spin({top:a(window).height()/2,left:a(window).width()/2});g.onload=function(){f.canvas.width=g.width;f.canvas.height=g.height;f.drawImage(g,0,0);stackBlurCanvasRGBA(f.canvas.id,0,0,f.canvas.width,f.canvas.height,d.blurRadius);var b=f.canvas.toDataURL("image/"+d.imageType),c={background:e.css("background-color")+" url("+b+") fixed center no-repeat","-webkit-background-size":"cover","-moz-background-size":"cover","-o-background-size":"cover","-ms-background-size":"cover","background-size":"cover"};return e.spin(!1).css(c)};g.src=d.imagePath}})(jQuery);var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];