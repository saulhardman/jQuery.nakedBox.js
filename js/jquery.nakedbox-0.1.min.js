/**
 * jQuery Naked Box 0.1
 * https://github.com/saulhardman/jquery.nakedbox.js
 * Saul Hardman (@saulhardman)
 */(function(a){a.fn.nakedBox=function(b){var c={overlayColor:"rgba(20, 20, 20, .8)",boxShadow:"0 0 10px rgba(20, 20, 20, .8), 0 0 40px rgba(20, 20, 20, .8)",borderColor:"#fff",borderSize:0,pathToImage:"img/imageLoader.gif",speed:500,keyboard:!0,spinOptions:{lines:8,length:6,width:2,radius:8}},d=a.extend({},c,b),e=a(this),f,g,h,i,j,k,l,m,n,o,p,q={element:null,initialised:!1,inProgress:!1,hasNavigation:!1,hasCaptions:!1,useSpin:a.isFunction(a.fn.spin),createElements:function(){f=a("<div/>",{id:"overlay"}).css({top:0,left:0,height:"100%",width:"100%",position:"fixed",backgroundColor:"transparent",filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000050,endColorstr=#99000050)",zoom:1,"background-color":d.overlayColor});g=a("<figure/>",{id:"viewer"});g.css({position:"absolute",top:"50%",left:"50%",width:0,height:0,marginTop:-(g.height()+d.borderSize*2)/2,marginLeft:-(g.width()+d.borderSize*2)/2,padding:d.borderSize,backgroundColor:d.borderColor,boxShadow:d.boxShadow});if(e.filter("[data-caption]").length){this.hasCaptions=!0;m=a("<figcaption/>",{id:"caption"}).css({padding:10,background:"#fff"})}i=a("<img>").attr("id","magnified").css({opacity:0,display:"block",position:"relative",zIndex:2}).appendTo(g);this.useSpin||(h=a("<img>",{id:"loader",src:d.pathToImage,alt:"Loader"}).css({position:"absolute",top:"50%",left:"50%",margin:"-8px 0 0 -8px"}));var b=e.filter("[data-group]");b.length>0&&b.each(function(){var c=a(this);if(b.filter("[data-group="+c.attr("data-group")+"]").length>1){q.hasNavigation=!0;return!1}});if(q.hasNavigation){var c={position:"absolute",height:"100%",width:"50%",top:0,opacity:0,backgroundColor:"#fff",zIndex:3};j=a("<a/>",{id:"nextLink","class":"navLink"}).css(c).css("right",0);k=a("<a/>",{id:"previousLink","class":"navLink"}).css(c).css("left",0)}f.append(g).appendTo("body")},bindEventListeners:function(){f.click(function(){f.fadeTo(d.speed,0,function(){f.hide().css("opacity",.2).removeClass("shown");g.css({height:0,width:0,marginTop:-(0+d.borderSize*2)/2,marginLeft:-(0+d.borderSize*2)/2})})});g.on("click",".navLink",function(b){b.preventDefault();if(q.inProgress)return!1;q.inProgress=!0;var c=a(this);c.attr("id")==="nextLink"?p++:p--;i.fadeTo(d.speed,0,function(){a(this).detach();q.useSpin?g.spin(d.spinOptions):g.append(h);j.add(k).detach();q.loadImage(c.attr("href"))});q.hasCaptions&&m.fadeTo(d.speed,0,function(){m.detach()});return!1}).click(function(a){a.stopPropagation()});q.hasNavigation&&j.add(k).hover(function(){a(this).css("opacity",.2)},function(){a(this).css("opacity",0)});d.keyboard&&a(document).keydown(function(a){switch(a.keyCode){case 27:f.trigger("click");break;case 37:k.css("opacity",.2).trigger("click");break;case 39:j.css("opacity",.2).trigger("click")}})},loadImage:function(a){var b=new Image,c={};b.src=a;b.onload=function(){i.attr("src",b.src);c.width=b.width;c.height=b.height;i.css("opacity",0).appendTo(g);q.hasCaptions&&(c.height+=q.setCaption());q.hasNavigation&&q.setNavigation();q.useSpin?g.spin(!1):h.detach();g.animate({width:c.width,height:c.height,marginLeft:-(c.width+d.borderSize*2)/2,marginTop:-(c.height+d.borderSize*2)/2},d.speed,function(){i.fadeTo(d.speed,1,function(){q.inProgress=!1});q.hasCaptions&&m.fadeTo(d.speed,1)})}},setNavigation:function(){j.add(k).css("opacity",0).detach();if(n.length)if(p===0)j.attr("href",n.eq(p+1).attr("href")).appendTo(g);else if(p>0&&p<n.length-1){j.attr("href",n.eq(p+1).attr("href")).appendTo(g);k.attr("href",n.eq(p-1).attr("href")).appendTo(g)}else k.attr("href",n.eq(p-1).attr("href")).appendTo(g)},setCaption:function(){var a;q.hasNavigation?n.length?a=n.eq(p):a=q.element:a=q.element;if(typeof a.data("caption")!="undefined"){var b=parseInt(m.css("padding-left"),10)+parseInt(m.css("padding-right"),10);m.text(a.data("caption")).css({width:i.width()-b,opacity:0}).show();m.appendTo(g);return m.outerHeight()}return 0}};return e.click(function(b){b.preventDefault();var c=a(this);q.element=c;if(q.initialised===!1){q.createElements();q.bindEventListeners();q.initialised=!0}f.show().fadeTo(d.speed,1,function(){f.addClass("shown")});if(q.hasNavigation){o=c.attr("data-group");n=e.filter("[data-group="+o+"]");p=n.index(c)}q.hasCaptions&&m.detach();i.detach();q.hasNavigation&&j.add(k).detach();q.loadImage(c.attr("href"));return!1})}})(jQuery);